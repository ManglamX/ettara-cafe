<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe Events</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .navbar {
            background-color: #ffffff;
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4a2c2a;
        }
        .nav-links {
            display: flex;
            gap: 20px;
        }
        .nav-links a {
            text-decoration: none;
            color: #4a2c2a;
            font-weight: 500;
        }
        .cart-button, .insist-button {
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .cart-button {
            background-color: #4a2c2a;
            color: white;
        }
        .insist-button {
            background-color: #d2b48c;
            color: #4a2c2a;
        }

        .page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        form {
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin-bottom: 2rem;
        }

        form div {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
        }

        input, textarea {
            width: 100%;
            padding: 0.5rem;
        }

        button {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            margin-right: 0.5rem;
        }

        button:hover {
            background-color: #555;
        }

        .events-container {
            display: flex;
            gap: 2rem;
        }

        .events-list {
            flex: 1;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .event-card {
            border: 1px solid #ccc;
            padding: 1rem;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }

        .event-card img {
            width: 250px;
            height: 150px;
            object-fit: cover;
            margin-bottom: 1rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .footer {
        background-color: #f5e6d3;
        color: #4a2c2a;
        padding: 50px 0;
        font-family: Arial, sans-serif;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
    }
    .footer-content {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .footer-logo {
        flex: 1;
        max-width: 200px;
    }
    .logo-text {
        margin-top: 10px;
        font-size: 24px;
    }
    .footer-links {
        flex: 2;
        display: flex;
        justify-content: space-between;
    }
    .footer-section {
        margin-right: 30px;
    }
    .footer-section h3 {
        margin-bottom: 15px;
        font-size: 18px;
    }
    .footer-section ul {
        list-style-type: none;
        padding: 0;
    }
    .footer-section ul li {
        margin-bottom: 10px;
    }
    .footer-section a {
        color: #4a2c2a;
        text-decoration: none;
    }
    .footer-cta {
        flex: 1;
        text-align: right;
    }
    .order-btn {
        display: block;
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: none;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        cursor: pointer;
    }
    .zomato {
        background-color: #cb202d;
    }
    .swiggy {
        background-color: #fc8019;
    }
    .open-hours {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-top: 20px;
    }
    .hours-icon {
        width: 50px;
        height: 50px;
        border: 2px solid #4a2c2a;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 10px;
        font-weight: bold;
    }
    .footer-bottom {
        margin-top: 30px;
        text-align: center;
        border-top: 1px solid #4a2c2a;
        padding-top: 20px;
    }
    .social-icons {
        margin-bottom: 15px;
    }
    .social-icon {
        font-size: 20px;
        margin: 0 10px;
        color: #4a2c2a;
    }
    @media (max-width: 768px) {
        .footer-content {
            flex-direction: column;
        }
        .footer-logo, .footer-links, .footer-cta {
            flex: 1 1 100%;
            max-width: 100%;
            text-align: center;
            margin-bottom: 30px;
        }
        .footer-links {
            flex-direction: column;
        }
        .footer-section {
            margin-right: 0;
            margin-bottom: 20px;
        }
    }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo">ETTāRRA</div>
                <div class="nav-links">
                    <a href="main.html">Home</a>
                    <a href="#">Admin</a>
                    <a href="#event-card">Event Card</a>
                    <a href="#">Contact us</a>
                </div>
            </div>
        </div>
    </nav>

    <div id="home" class="page">
        <div class="cont">
            <h1>Cafe Events</h1>
            <form id="addEventForm">
                <div>
                    <label for="eventName">Event Name</label>
                    <input type="text" id="eventName" required>
                </div>
                <div>
                    <label for="eventDate">Event Date</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div>
                    <label for="eventDescription">Event Description</label>
                    <textarea id="eventDescription" required></textarea>
                </div>
                <div>
                    <label for="eventPhoto">Event Photo</label>
                    <input type="file" id="eventPhoto" accept="image/*" required>
                </div>
                <div>
                    <label for="foodMenu">Food Menu</label>
                    <textarea id="foodMenu" required></textarea>
                </div>
                <div>
                    <label for="pricePerPerson">Price Per Person (₹)</label>
                    <input type="number" id="pricePerPerson" min="0" step="1" required>
                </div>
                <button type="submit">Add Event</button>
            </form>
        </div>

        <div class="events-container">
            <div class="events-list">
                <h2>All Events</h2>
                <div id="eventsList" class="events-grid"></div>
            </div>
            <div class="events-list">
                <h2>Upcoming Events</h2>
                <div id="upcomingEventsList" class="events-grid"></div>
            </div>
        </div>
    </div>

    <div id="event-card" class="page" style="display: none;">
        <h1>Event Details</h1>
        <div id="eventCardContainer"></div>
        <button onclick="window.location.hash = '#home'">Back to Home</button>
    </div>

    <div id="updateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Update Event</h2>
            <form id="updateEventForm">
                <input type="hidden" id="updateEventId">
                <div>
                    <label for="updateEventName">Event Name</label>
                    <input type="text" id="updateEventName" required>
                </div>
                <div>
                    <label for="updateEventDate">Event Date</label>
                    <input type="date" id="updateEventDate" required>
                </div>
                <div>
                    <label for="updateEventDescription">Event Description</label>
                    <textarea id="updateEventDescription" required></textarea>
                </div>
                <div>
                    <label for="updateEventPhoto">Event Photo</label>
                    <input type="file" id="updateEventPhoto" accept="image/*">
                </div>
                <div>
                    <label for="updateFoodMenu">Food Menu</label>
                    <textarea id="updateFoodMenu" required></textarea>
                </div>
                <div>
                    <label for="updatePricePerPerson">Price Per Person (₹)</label>
                    <input type="number" id="updatePricePerPerson" min="0" step="1" required>
                </div>
                <button type="submit">Update Event</button>
            </form>
        </div>
    </div>



    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="40" fill="#1a2b4a"/>
                        <path d="M30 50 Q 50 20, 70 50 Q 60 70, 50 60 Q 40 70, 30 50" fill="none" stroke="white" stroke-width="2"/>
                    </svg>
                    <h2 class="logo-text">ETTāRRA</h2>
                </div>
                <div class="footer-links">
                    <div class="footer-section">
                        <h3>Quick Links</h3>
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Ettarra Insists</a></li>
                            <li><a href="#">Brew Stories</a></li>
                            <li><a href="#">Contact Us</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3>Address</h3>
                        <p>Juhu Residency Boutique Hotel, Mumbai, Maharashtra 400049</p>
                        <p><i class="fas fa-map-marker-alt"></i> Juhu, Mumbai</p>
                    </div>
                    <div class="footer-section">
                        <h3>Contact</h3>
                        <p><i class="fas fa-phone"></i> +91 98256 03145</p>
                        <p><i class="fas fa-envelope"></i> care@ettarracoffee.in</p>
                    </div>
                </div>
                <div class="footer-cta">
                    <button class="order-btn zomato">
                        <i class="fas fa-utensils"></i> Order On Zomato
                    </button>
                    <button class="order-btn swiggy">
                        <i class="fas fa-bicycle"></i> Order On Swiggy
                    </button>
                    <div class="open-hours">
                        <span>Open For Dine-In</span>
                        <div class="hours-icon">24/7</div>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-spotify"></i></a>
                </div>
                <p>&copy; Ettarra Coffee House 2024. Webworks by Infobahn</p>
                <p>Registered name: Bunts Hotels Private Limited</p>
            </div>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCSsatonj0k4Bme9HQAmH7ce2BUNgV25Bg",
    authDomain: "ettara-coffee.firebaseapp.com",
    databaseURL: "https://ettara-coffee-default-rtdb.firebaseio.com",
    projectId: "ettara-coffee",
    storageBucket: "ettara-coffee.appspot.com",
    messagingSenderId: "936196066889",
    appId: "1:936196066889:web:526891abbf12edc58f3998",
    measurementId: "G-YW6KXHHN3G"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Add event form submission
        const addEventForm = document.getElementById('addEventForm');
        addEventForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const eventName = document.getElementById('eventName').value;
            const eventDate = document.getElementById('eventDate').value;
            const eventDescription = document.getElementById('eventDescription').value;
            const eventPhoto = document.getElementById('eventPhoto').files[0];
            const foodMenu = document.getElementById('foodMenu').value;
            const pricePerPerson = document.getElementById('pricePerPerson').value;

            try {
                // Upload photo to Firebase Storage
                const storageRef = storage.ref('event_photos/' + eventPhoto.name);
                await storageRef.put(eventPhoto);
                const photoUrl = await storageRef.getDownloadURL();

                // Add event to Firestore
                const docRef = await db.collection('events').add({
                    name: eventName,
                    date: eventDate,
                    description: eventDescription,
                    photoUrl: photoUrl,
                    foodMenu: foodMenu,
                    pricePerPerson: parseInt(pricePerPerson)
                });

                alert('Event added successfully!');
                addEventForm.reset();
                displayAllEvents();
                displayUpcomingEvents();
                createEventCard(docRef.id);
            } catch (error) {
                console.error('Error adding event: ', error);
                alert('Error adding event. Please try again.');
            }
        });

        // Display all events
        function displayAllEvents() {
            const eventsList = document.getElementById('eventsList');
            
            db.collection('events').onSnapshot((snapshot) => {
                eventsList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const event = doc.data();
                    const eventCard = document.createElement('div');
                    eventCard.classList.add('event-card');
                    eventCard.innerHTML = `
                        <img src="${event.photoUrl}" alt="${event.name}" style="width: 250px; height: 150px; object-fit: cover;">
                        <h3>${event.name}</h3>
                        <p>Date: ${event.date}</p>
                        <p>${event.description.substring(0, 100)}...</p>
                        <p>Price: ₹${event.pricePerPerson} per person</p>
                        <button onclick="window.location.hash = '#event-card/${doc.id}'">View Details</button>
                        <button onclick="openUpdateModal('${doc.id}', ${JSON.stringify(event).replace(/"/g, '&quot;')})">Edit</button>
                        <button onclick="deleteEvent('${doc.id}')">Delete</button>
                    `;
                    eventsList.appendChild(eventCard);
                });
            });
        }

        // Display upcoming events
        function displayUpcomingEvents() {
            const upcomingEventsList = document.getElementById('upcomingEventsList');
            
            db.collection('events').where('date', '>=', new Date().toISOString().split('T')[0])
                .orderBy('date')
                .onSnapshot((snapshot) => {
                    upcomingEventsList.innerHTML = '';
                    snapshot.forEach((doc) => {
                        const event = doc.data();
                        const eventCard = document.createElement('div');
                        eventCard.classList.add('event-card');
                        eventCard.innerHTML = `
                            <img src="${event.photoUrl}" alt="${event.name}" style="width: 250px; height: 150px; object-fit: cover;">
                            <h3>${event.name}</h3>
                            <p>Date: ${event.date}</p>
                            <p>${event.description.substring(0, 100)}...</p>
                            <p>Price: ₹${event.pricePerPerson} per person</p>
                            <button onclick="window.location.hash = '#event-card/${doc.id}'">View Details</button>
                        `;
                        upcomingEventsList.appendChild(eventCard);
                    });
                });
        }

        // Create event card
        function createEventCard(eventId) {
            db.collection('events').doc(eventId).get().then((doc) => {
                if (doc.exists) {
                    const event = doc.data();
                    const eventCardContainer = document.getElementById('eventCardContainer');
                    eventCardContainer.innerHTML = `
                        <img src="${event.photoUrl}" alt="${event.name}" style="width: 250px; height: 150px; object-fit: cover;">
                        <h2>${event.name}</h2>
                        <p>Date: ${event.date}</p>
                        <p>${event.description}</p>
                        <h3>Food Menu:</h3>
                        <p>${event.foodMenu}</p>
                        <p>Price per person: ₹${event.pricePerPerson}</p>
                    `;
                    window.location.hash = #event-card/${eventId};
                } else {
                    console.log("No such document!");
                }
            }).catch((error) => {
                console.log("Error getting document:", error);
            });
        }

        // Delete event
        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                db.collection('events').doc(eventId).delete()
                .then(() => {
                    alert('Event deleted successfully!');
                    displayAllEvents();
                    displayUpcomingEvents();
                })
                .catch((error) => {
                    console.error('Error deleting event: ', error);
                    alert('Error deleting event. Please try again.');
                });
            }
        }

        // Open update modal
        function openUpdateModal(eventId, event) {
            const modal = document.getElementById('updateModal');
            const updateEventId = document.getElementById('updateEventId');
            const updateEventName = document.getElementById('updateEventName');
            const updateEventDate = document.getElementById('updateEventDate');
            const updateEventDescription = document.getElementById('updateEventDescription');
            const updateFoodMenu = document.getElementById('updateFoodMenu');
            const updatePricePerPerson = document.getElementById('updatePricePerPerson');

            updateEventId.value = eventId;
            updateEventName.value = event.name;
            updateEventDate.value = event.date;
            updateEventDescription.value = event.description;
            updateFoodMenu.value = event.foodMenu;
            updatePricePerPerson.value = event.pricePerPerson;

            modal.style.display = 'block';
        }

        // Close update modal
        const closeBtn = document.getElementsByClassName('close')[0];
        closeBtn.onclick = function() {
            document.getElementById('updateModal').style.display = 'none';
        }

        // Update event form submission
        const updateEventForm = document.getElementById('updateEventForm');
        updateEventForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const eventId = document.getElementById('updateEventId').value;
            const eventName = document.getElementById('updateEventName').value;
            const eventDate = document.getElementById('updateEventDate').value;
            const eventDescription = document.getElementById('updateEventDescription').value;
            const eventPhoto =   document.getElementById('updateEventPhoto').files[0];
            const foodMenu = document.getElementById('updateFoodMenu').value;
            const pricePerPerson = document.getElementById('updatePricePerPerson').value;

            try {
                const updateData = {
                    name: eventName,
                    date: eventDate,
                    description: eventDescription,
                    foodMenu: foodMenu,
                    pricePerPerson: parseInt(pricePerPerson)
                };

                if (eventPhoto) {
                    // Upload new photo to Firebase Storage
                    const storageRef = storage.ref('event_photos/' + eventPhoto.name);
                    await storageRef.put(eventPhoto);
                    const photoUrl = await storageRef.getDownloadURL();
                    updateData.photoUrl = photoUrl;
                }

                // Update event in Firestore
                await db.collection('events').doc(eventId).update(updateData);

                alert('Event updated successfully!');
                document.getElementById('updateModal').style.display = 'none';
                displayAllEvents();
                displayUpcomingEvents();
                if (window.location.hash.startsWith('#event-card/')) {
                    createEventCard(eventId);
                }
            } catch (error) {
                console.error('Error updating event: ', error);
                alert('Error updating event. Please try again.');
            }
        });

        // Navigation
        function handleNavigation() {
            const hash = window.location.hash.split('/')[0];
            document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
            document.querySelector(hash || '#home').style.display = 'block';

            if (hash === '#home') {
                displayAllEvents();
                displayUpcomingEvents();
            } else if (hash === '#event-card') {
                const eventId = window.location.hash.split('/')[1];
                createEventCard(eventId);
            }
        }

        // Call handleNavigation when the page loads and when the hash changes
        window.addEventListener('load', handleNavigation);
        window.addEventListener('hashchange', handleNavigation);

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('updateModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Initial display of events
        displayAllEvents();
        displayUpcomingEvents();
    </script>
</body>
</html>